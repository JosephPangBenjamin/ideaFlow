# Story 4.1: æƒ³æ³•è½¬åŒ–ä¸ºä»»åŠ¡ (Idea to Task Conversion)

Status: done

## Story

As a **ç”¨æˆ·**,
I want **å°†æƒ³æ³•ä¸€é”®è½¬åŒ–ä¸ºä»»åŠ¡**,
so that **æ¨åŠ¨æƒ³æ³•è½åœ°æ‰§è¡Œ**.

## Acceptance Criteria

1. **å…¥å£è§¦å‘ (Entry Point)**:
   - **Given** ç”¨æˆ·åœ¨æƒ³æ³•è¯¦æƒ…é¢æ¿æˆ–ç”»å¸ƒä¸Šçš„æƒ³æ³•èŠ‚ç‚¹
   - **When** ç‚¹å‡»ã€Œè½¬ä¸ºä»»åŠ¡ã€æŒ‰é’®
   - **Then** å¼¹å‡ºç®€æ´çš„ä»»åŠ¡åˆ›å»ºé¢æ¿
   - **And** æƒ³æ³•å†…å®¹è‡ªåŠ¨å¡«å…¥ä»»åŠ¡æ ‡é¢˜

2. **ä»»åŠ¡åˆ›å»º (Task Creation)**:
   - **Given** ä»»åŠ¡åˆ›å»ºé¢æ¿å·²æ‰“å¼€
   - **When** ç‚¹å‡»ã€Œåˆ›å»ºä»»åŠ¡ã€æŒ‰é’®
   - **Then** ä»»åŠ¡åˆ›å»ºæˆåŠŸ
   - **And** æƒ³æ³•ä¸ä»»åŠ¡ä¿æŒå…³è”ï¼ˆé€šè¿‡ `ideaId`ï¼‰
   - **And** æ˜¾ç¤ºã€Œä»»åŠ¡å·²åˆ›å»º ğŸ‰ã€åº†ç¥åŠ¨æ•ˆ
   - **And** è®°å½• `task_created` åŸ‹ç‚¹äº‹ä»¶

3. **å…³è”ä¸åé¦ˆ (Association & Feedback)**:
   - **Given** ä»»åŠ¡å·²ä»æƒ³æ³•è½¬åŒ–
   - **When** æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
   - **Then** å¯ä»¥çœ‹åˆ°åŸå§‹æƒ³æ³•çš„é“¾æ¥ä¸”ç‚¹å‡»å¯è·³è½¬
   - **And** åœ¨ç”»å¸ƒä¸Šï¼Œå¯¹åº”çš„æƒ³æ³•èŠ‚ç‚¹åº”æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€å›¾æ ‡ï¼ˆå¦‚ï¼šå¾…åŠ ğŸ“‹ï¼‰

4. **æƒ³æ³•æ ‡è®°ä¸å¯¼èˆª (Idea Badge & Navigation)**:
   - **Given** æƒ³æ³•å·²å…³è”ä»»åŠ¡
   - **When** æŸ¥çœ‹æƒ³æ³•å¡ç‰‡æˆ–è¯¦æƒ…
   - **Then** æ˜¾ç¤ºã€Œå·²è½¬ä»»åŠ¡ã€æ ‡è®°
   - **And** ç‚¹å‡»æ ‡è®°å¯è·³è½¬åˆ°å…³è”çš„ä»»åŠ¡è¯¦æƒ…é¡µï¼Œå½¢æˆé—­ç¯

## Tasks / Subtasks

- [x] Task 1: Backend - Tasks æ¨¡å—å®Œæ•´å®ç° (AC: #2, #3)
  - [x] 1.1 åˆ›å»º `tasks.module.ts`ã€`tasks.controller.ts`ã€`tasks.service.ts`
  - [x] 1.2 å®ç° `POST /ideaFlow/api/v1/tasks` (åˆ›å»ºä»»åŠ¡æ—¶éœ€ `include: { idea: true }`)
  - [x] 1.3 å®ç° `GET /ideaFlow/api/v1/tasks` (æ”¯æŒåˆ†é¡µ)
  - [x] 1.4 å®ç° `GET /ideaFlow/api/v1/tasks/:id` (éœ€åŒ…å« `idea` ä¿¡æ¯)
  - [x] 1.5 åˆ›å»º CreateTaskDto å’Œ UpdateTaskDto éªŒè¯ç±»
  - [x] 1.6 åœ¨ AppModule æ³¨å†Œ TasksModule
  - [x] 1.7 ç¼–å†™ `tasks.service.spec.ts` å•å…ƒæµ‹è¯•

- [x] Task 2: Backend - å…³è”é€»è¾‘å¢å¼º (AC: #3)
  - [x] 2.1 ç¡®ä¿æƒ³æ³• API å“åº”ä¸­åŒ…å« `taskId`ï¼ˆæˆ–å…³è”çš„ä»»åŠ¡çŠ¶æ€åˆ—è¡¨ï¼‰
  - [x] 2.2 ç¡®ä¿ `hasTask` å­—æ®µèƒ½å‡†ç¡®åæ˜ è¯¥æƒ³æ³•æ˜¯å¦å·²æœ‰ç”Ÿæˆçš„ä»»åŠ¡

- [x] Task 3: Frontend - ä»»åŠ¡åˆ›å»ºé¢æ¿ç»„ä»¶ (AC: #1, #2)
  - [x] 3.1 åˆ›å»º `CreateTaskModal.tsx` ä»»åŠ¡åˆ›å»ºå¯¹è¯æ¡†
  - [x] 3.2 å®ç°å¡«å……æƒ³æ³•å†…å®¹åˆ°æ ‡é¢˜
  - [x] 3.3 å®ç°åˆ›å»ºæˆåŠŸçš„ Confetti åº†ç¥åŠ¨æ•ˆ
  - [x] 3.4 ä»»åŠ¡åˆ›å»ºåè§¦å‘å…¨å±€æŸ¥è¯¢åˆ·æ–°ï¼ˆIdea & Canvas Dataï¼‰

- [x] Task 4: Frontend - æƒ³æ³•è¯¦æƒ…ä¸å¯¼èˆªé—­ç¯ (AC: #4)
  - [x] 4.1 åœ¨ `IdeaDetail.tsx` æ·»åŠ ã€Œè½¬ä¸ºä»»åŠ¡ã€æŒ‰é’®
  - [x] 4.2 æ˜¾ç¤ºå¯è§çš„ã€Œå·²è½¬ä»»åŠ¡ã€æ ‡è®°ï¼Œå¹¶å®ç°ç‚¹å‡»è·³è½¬åˆ°å¯¹åº” Task çš„é€»è¾‘

- [x] Task 5: Frontend - ç”»å¸ƒèŠ‚ç‚¹çŠ¶æ€åŒæ­¥ (AC: #3)
  - [x] 5.1 ä¿®æ”¹ `CanvasNode.tsx`ï¼šå½“èŠ‚ç‚¹å…³è”çš„æƒ³æ³•æœ‰ä»»åŠ¡æ—¶ï¼Œåœ¨è§’è½æ˜¾ç¤ºçŠ¶æ€å›¾æ ‡ï¼ˆTodo/Doneï¼‰
  - [x] 5.2 ç¡®ä¿çŠ¶æ€å˜æ›´åç”»å¸ƒèƒ½å¤Ÿå®æ—¶/æˆ–åˆ·æ–°åæ˜¾ç¤ºæœ€æ–°çŠ¶æ€

- [x] Task 6: Frontend - ä»»åŠ¡è¯¦æƒ…åŸºç¡€å®ç° (AC: #3)
  - [x] 6.1 åˆ›å»º `TaskDetail.tsx` æ˜¾ç¤ºåŸºç¡€å­—æ®µåŠå…³è”æƒ³æ³•é“¾æ¥

- [/] Task 7: åŸ‹ç‚¹ã€æµ‹è¯•ä¸ E2E (AC: All)
  - [x] 7.1 å®ç° `task_created` åŸ‹ç‚¹
  - [x] 7.2 ç¼–å†™ `idea-to-task` å®Œæ•´é“¾è·¯çš„ Playwright E2E æµ‹è¯•
  - [x] 7.3 ç¡®ä¿å‰åç«¯å•å…ƒæµ‹è¯• 100% é€šè¿‡
  - [x] 7.4 [AI-Review] è¡¥å……å‰ç«¯ç»„ä»¶å•å…ƒæµ‹è¯• (CreateTaskModal, TaskDetail)

## Dev Notes

### æŠ€æœ¯è¦ç‚¹æç¤º

1. **API å…³è”è¿”å›**ï¼šåç«¯åœ¨ `create` å’Œ `findOne` æ—¶åŠ¡å¿…ä½¿ç”¨ Prisma çš„ `include` åŒ…å« `idea` å¯¹è±¡ï¼Œå¦åˆ™å‰ç«¯ AC 3 å°†æ— æ³•è½½å…¥å†…å®¹ã€‚
2. **ç”»å¸ƒæ¸²æŸ“ä¼˜åŒ–**ï¼šåœ¨ `CanvasNode.tsx` å¢åŠ çŠ¶æ€å›¾æ ‡æ—¶ï¼Œæ³¨æ„ Konva çš„æ¸²æŸ“æ€§èƒ½ï¼Œåˆ©ç”¨ `React.memo` é˜²æ­¢ä¸å¿…è¦çš„é‡ç»˜ã€‚
3. **å¯¼èˆªé—­ç¯**ï¼šé€šè¿‡ `react-router-dom` çš„ `useNavigate` å®ç° Idea åˆ° Task çš„æ— ç¼åˆ‡æ¢ã€‚

### æ¶æ„åˆè§„æ€§

- **API å‰ç¼€**: `/ideaFlow/api/v1/tasks`
- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ Jotai è§¦å‘ `ideasAtom` å’Œ `canvasNodesAtom` çš„å¼‚æ­¥åˆ·æ–°ã€‚

### References

- [Source: prisma/schema.prisma - Task Model]
- [Source: validation-report-4-1.md - è´¨é‡å®¡è®¡å‘ç°é¡¹]
- [Source: architecture.md - å®ç°æ¨¡å¼]

### Change Log

- **2026-01-10**: [AI-Review] ä¿®å¤æœªè·Ÿè¸ªçš„ git æ–‡ä»¶ï¼›ç¡®è®¤å¹¶æ ‡è®° E2E æµ‹è¯• (7.2) ä¸ºå®Œæˆã€‚
- **2026-01-10**: [AI-Review] æ‰§è¡Œä»£ç å®¡æŸ¥ï¼Œä¿®å¤äº† CanvasNode memoizationã€IdeaDetail å¯¼èˆªé—®é¢˜å’Œ CreateTaskModal åŸ‹ç‚¹ç¼ºå¤±é—®é¢˜ã€‚æ–°å¢ Task 7.4 è¡¥å……å•å…ƒæµ‹è¯•ã€‚
