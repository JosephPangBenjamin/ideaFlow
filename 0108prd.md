# IdeaFlow v2 Product Requirements Document (0108 Version)

> **版本及日期**: 2026-01-08
> **状态**: 待开发 (Planned)

---

--- 1. 仪表盘、想法、任务、画布、设置 加载数据全部使用画布下面的骨架屏
--- 2. 输入想法来源后，在任务和画布中没有体现出来当时产生这个想法的场景
--- 3. 在想法菜单下，侧边栏弹窗删除不了想法、编辑似乎会自动保存，不要自动保存
--- 4. 想法详情也没有任何想法来源，并且侧边栏样式太丑，并且和画布中的侧边栏宽度不一致，样式也不一致
--- 5. 来源记录的不够全面，不能深刻的体现出来当时的场景，想法来源
--- 6. 想法-任务-画布，任何和画布可以单独删除，想法需要联动删除，想法删除后，其下面的任务和画布需要联动删除
--- 7. 从想法的侧边栏 现在是如果已经创建了任务，图标就会变，提示查看已关联的任务，需求：画布也要这样的
--- 8. 当在登录后的页面，半天没动静，控制台Failed to load resource: the server responded with a status of 401 (Unauthorized)
:5173/ideaFlow/api/v1/ideas?page=1&limit=20:1
:5173/ideaFlow/api/v1/auth/refresh:1
如果是token过期，请立即提示重新登录或者直接跳转到登录页面

## 1. 产品愿景 (Product Vision)

**核心价值主张**: **除了记录，更能落地。**
IdeaFlow 不仅仅是一个碎片化想法记录工具，更是一个结合 **AI 智能**与 **BMAD 敏捷方法论**的产品孵化平台。它帮助用户将模糊的灵感，通过结构化的画布梳理、AI 辅助完善，自动转化为标准化的产品文档（PRD/架构/Epics），并生成可执行的开发项目。

---

## 2. 用户旅程 (User Journey)

我们采用统一的用户流程，适用于所有类型的创造者（创业者、开发者、产品经理等）：

1.  **想法记录**: 快速捕捉碎片化灵感（文字、链接、图片）。
2.  **深度梳理**: 进入专属画布，拆解想法，添加标注、图片、子想法。
3.  **AI 协同**:
    - 在侧边栏开启 AI 辅助，自动感知画布上下文。
    - AI 提供竞品分析、前置条件优化建议。
    - 用户配置多模型 API Key（OpenAI/Claude/Gemini）。
4.  **BMAD 孵化 (Phase 1-3)**:
    - 系统引导安装并运行 BMAD 工作流（头脑风暴 → 研究 → 产品简报 → PRD → 架构）。
    - AI 根据生成的文档内容，自动整理/更新画布节点结构。
5.  **项目生成**:
    - 想法成熟后，系统生成标准的 BMAD 项目结构文件。
    - 绑定 GitHub，推送项目代码仓库。
6.  **落地开发 (Phase 4)**:
    - 用户 Clone 仓库到本地。
    - 在 Cursor/VS Code 等编辑器中，遵循标准 BMAD 流程进行编码实现。

---

## 3. 核心功能需求 (Functional Requirements)

### 3.1 想法管理 (Idea Management)

- **FR-001 想法录入**: 支持Markdown文本、图片上传、链接解析的富文本编辑器。
- **FR-002 想法列表**: 按时间倒序排列，支持搜索、归档。
- **FR-003 项目化绑定**: 每个想法对应唯一的“项目空间”，包含一个主画布和一套文件系统。

### 3.2 深度画布 (Deep Canvas)

画布是思维可视化的核心载体，需支持以下节点类型与交互：

- **节点类型**:
  - **主想法节点 (Root Node)**: 只读，与想法列表内容同步，作为画布的核心锚点。
  - **子想法节点 (Sub-Idea)**: 可编辑，用于发散思维、细化功能。
  - **批注节点 (Note)**: 纯文本便签，用于记录灵感碎片或备注。
  - **媒体节点 (Media)**: 图片、外链卡片，支持缩放预览。
- **连接与关系**:
  - 支持节点间自由连线，连线可添加文字标注。
  - **动态吸附**: 连线自动吸附到最近的节点手柄（参考 v1.1 修复）。
- **操作体验**: 无限画布、缩放/平移、小地图导航。

### 3.3 AI 智能侧边栏 (AI Sidebar)

- **FR-004 上下文感知**: AI 自动读取当前画布的所有节点内容、连线关系作为 Context。
- **FR-005 多模型支持**:
  - 用户在设置页配置 API Key (OpenAI, Claude, Gemini, DeepSeek 等)。
  - 支持选择当前对话使用的模型。
- **FR-006 智能对话**:
  - 自由问答：针对想法的咨询讨论。
  - **主动建议**: AI 分析当前内容，提示缺失的前置条件（如“缺少竞品分析”、“目标用户不明确”）。
- **FR-007 画布操作能力**: AI 可调用工具在画布上自动创建节点、整理布局。

### 3.4 BMAD 集成引擎

IdeaFlow 负责 BMAD 方法论的前三个阶段（规划与设计）：

- **FR-008 BMAD 环境初始化**:
  - 检测/提示安装 BMAD 依赖（模拟环境）。
  - 生成 `.agent/workflows` 及标准目录结构。
- **FR-009 内置工作流向导**:
  - 可视化引导执行 `brainstorming`, `research`, `create-product-brief`, `create-prd`, `create-architecture` 等工作流。
  - 每一步生成对应的 Markdown 文档（存储在 `_bmad-output/`）。
- **FR-010 动态文档生成**:
  - PRD/架构文档生成后，提供系统内预览。
  - AI 解析文档结构，反向更新画布（例如：根据 PRD 的功能列表自动生成功能树节点）。

### 3.5 项目生成与交付

- **FR-011 项目脚手架**:
  - 基于架构决策，生成代码框架（前端/后端/配置）。
  - 包含完整的 `_bmad` 工具链配置（`.cursor`, `.claude` 适配文件）。
- **FR-012 GitHub 集成**:
  - GitHub OAuth 授权。
  - 创建新仓库或关联现有仓库。
  - 一键推送（Commit & Push）生成的文档和脚手架代码。

---

## 4. 非功能需求 (Non-Functional Requirements)

- **UI/UX**: 采用现代化深色主题（Dark Mode），科技感与沉浸感并重。
- **性能**: 画布需支持 500+ 节点流畅操作（60fps）。
- **数据安全**: API Key 仅存储在用户本地或加密存储，不进行明文传输。
- **扩展性**: AI Gateway 设计需支持快速接入新的大模型 API。

---

## 5. 技术架构 (Technical Architecture)

- **前端**: React + ReactFlow/Konva (画布) + TailwindCSS (UI)。
- **后端**: NestJS + Prisma (PostgreSQL)。
- **AI 层**: 自研 AI Gateway 模块，统一封装不同 LLM 的接口差异。
- **BMAD 适配**: 在后端集成 BMAD Core 的执行逻辑，或通过 Shell 适配层调用 BMAD CLI。

---

## 6. 开发规划 (Roadmap)

- **Phase 1 (核心重构)**: 想法-画布绑定、新节点类型、AI 侧边栏 UI。
- **Phase 2 (AI 集成)**: 多模型配置、上下文感知、AI 对话功能。
- **Phase 3 (BMAD 引擎)**: 工作流集成、文档生成、画布反向更新。
- **Phase 4 (当前)**: 修复现有 Bug，维护 v1 版本稳定性，为 v2 做技术储备。
